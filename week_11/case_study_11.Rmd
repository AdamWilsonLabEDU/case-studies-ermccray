---
title: "Case Study 11"
author: Emily McCray
date: November 9, 2024
output: github_document
---

#install new packages
#install.packages("mapview")
#install.packages("foreach")
#install.packages("doParallel")
#install.packages("tidycensus")

#load libraries
library(tidyverse)
library(spData)
library(sf)
library(mapview)
library(foreach)
library(doParallel)
library(tidycensus)

#REMOVE BEFORE PUSHING TO GITHUB
census_api_key("", install = TRUE, overwrite = TRUE)

registerDoParallel(4)
getDoParWorkers()

#code taken directly from instructions
#renaming race variables
race_vars <- c(
  "Total Population" = "P1_001N",
  "White alone" = "P1_003N",
  "Black or African American alone" = "P1_004N",
  "American Indian and Alaska Native alone" = "P1_005N",
  "Asian alone" = "P1_006N",
  "Native Hawaiian and Other Pacific Islander alone" = "P1_007N",
  "Some Other Race alone" = "P1_008N",
  "Two or More Races" = "P1_009N"
)

#selecting criteria for the data/obtaining the data (also copied from instructions)
options(tigris_use_cache = TRUE)
erie <- get_decennial(geography = "block", variables = race_vars, year=2020,
                  state = "NY", county = "Erie County", geometry = TRUE,
                  sumfile = "pl", ,cache_table=T) 

#cropping the data and converting it to a factor
cropped_erie <- erie %>%
  st_crop(c(xmin=-78.9,xmax=-78.85,ymin=42.888,ymax=42.92))
  
cropped_erie$variable <- as.factor(cropped_erie$variable)

#write a foreach loop for each race variable
erie_loop <- foreach(i = cropped_erie$variable[1:8], .combine='rbind') %dopar% 

  {cropped_erie %>%  
    filter(variable == variable[i]) %>%
      st_sample(., size=.$value, type = 'random') %>%  
  st_as_sf() %>%
    mutate(variable = i)
  }
    
#make a leaflet map of the dataset; set the zcol to the racial identity of each point 
mapview(erie_loop, zcol = "variable", cex = 1, alpha.regions = .5)
